language: android
sudo: true
git:
  depth: 5
addons:
  sauce_connect: true
android:
  components:
    - tools
    - build-tools-23.0.2
    - android-23
before_script:
  - cp .env.release .env
  - nvm install $(< .nvmrc)
  - npm install
script:
  - npm run build
  - npm run cordova:build android --release
  - npm run test:ci
branches:
  only:
    - demo/#2
    - master
deploy:
  - provider: heroku
    skip_cleanup: true
    api_key:
        secure: QvqFYlhfD3IF8Fq1pAPZ0nQmNHjcVv3aMlp4iAjSPfIx5NXDbv/zyobHAhaaVYapVWYUB54rAsg5i/RdhX/Pie5jNVeIREPi2rbPLbtYYtUon4jaeZ7dT/apeossQAUqZWL+rP7F4/hYMLSSKt7rNtMy27tHesmDXbgI5IM+s5B5PF4MWsKFVhvZo1kiTffs1X0zDlCHnzqRfcTA9XG/e8gfdisCwZMOUazkBQaxXaqGzlf1NKoIOy2lVCOn9aEYfiOCTue+V9D8Z5mINhW9tSqqa7/th3DDnDDeiseGFGKI8uiVcxbYsMdi56DhgaHUkEul+0X3g8CACCf2GErMUSyIboyh++PwVmmsQKZRk4CFkqMULVo8M3RwD7q0sxTZwGuJmif/0kJ19ugZgpaLUQEPF8jnJFEFX2h+gc+dU0j1IhuTQpnqy+h6WVv6FKxNxguDKl6OxQg2OsfaZD8ZKN2T6Jk7GLALsUYYHyiFLFyRKAfK379pyDImirGP0pLDEGsiNYByFlKz9ymMpJvDp6LaliUeR6NpfrxwhRQv9cG0XA2UGMpQMUwkOvKfQ+6COQK8u2qoNeqvN6yT3h8J9ZJmOl190VoPp2sHUgPAkFTVFLDD8xBgQHzsg9jZcM2ak/+P1DgYh5tnvWSuJpMQMAKvVifZUBxhfHGkqBT3pSw=
  - provider: releases
    api_key: "4870c604a46f39f1ff38069cfe8cc839e6af3d07"
    file: "./platforms/android/build/outputs/apk/android.apk"
    skip_cleanup: true
    on:
      tags: true
      branch: demo/#2
after_deploy:
  - npm run test:e2e
cache:
  directories:
    - node_modules
